# デプロイに関するルール

このプロジェクトをデプロイ・運用する際のルールを定めます。

## 1. デプロイ対象ブランチ

- **`main`** ブランチを本番環境への自動デプロイ対象とします。
- 開発中の機能や修正は、必ずフィーチャーブランチ (`feature/...`, `fix/...` など) で行い、プルリクエスト経由で `main` ブランチにマージしてください。

## 2. 環境変数

- APIキーやデータベースURLなどの機密情報は、決してコードに直接書き込まず、必ずRenderなどのホスティングサービスの環境変数機能を使用してください。
- 新しく環境変数を追加・変更した場合は、このドキュメントや `DEPLOY_ROADMAP.md` にその旨を記録し、チームメンバーに共有してください。
- ローカル開発用の環境変数ファイル (`.env.development` など) は、`.gitignore` に追加し、リポジトリにコミットしないでください。

## 3. データベースのマイグレーション

- データベースのスキーマ変更 (テーブル作成、カラム追加など) を伴う場合は、必ずRailsのマイグレーションファイルを作成してください。
- Renderのビルドコマンド (`bundle exec rails db:migrate`) によって、デプロイ時に自動でマイグレーションが実行されます。
- 一度 `main` ブランチにマージされたマイグレーションファイルは、決して変更・削除しないでください。修正が必要な場合は、新しいマイグレーションファイルを作成して対応してください。

## 4. CORS設定

- フロントエンドのURLが変更になった場合や、新しく外部サービスとの連携が必要になった場合は、RailsのCORS設定 (`config/initializers/cors.rb`) と、Renderの環境変数を見直してください。

## 5. ログの確認

- デプロイ後やアプリケーションの動作に問題が発生した場合は、まずRenderのログ画面を確認してください。
- `Rails` (バックエンド) と `Next.js` (フロントエンド) の両方のログを確認し、エラーの原因を特定してください。
